<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RavAI - Умный поиск</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: #4cc9f0;
        }

        .logo h1 {
            font-size: 3.2rem;
            background: linear-gradient(90deg, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }

        .tagline {
            font-size: 1.2rem;
            color: #b8c1ec;
            margin-top: 10px;
        }

        .search-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        #searchInput {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        #searchInput:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 2px #4cc9f0;
        }

        #searchInput::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        #searchButton {
            padding: 0 35px;
            background: linear-gradient(90deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #searchButton:hover {
            background: linear-gradient(90deg, #3a0ca3, #4361ee);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        .search-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .option-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            color: #b8c1ec;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background: rgba(76, 201, 240, 0.2);
            color: white;
        }

        .option-btn.active {
            background: rgba(76, 201, 240, 0.3);
            color: white;
            border-color: #4cc9f0;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mode-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            color: #b8c1ec;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mode-btn:hover {
            background: rgba(76, 201, 240, 0.1);
        }

        .mode-btn.active {
            background: rgba(114, 239, 221, 0.2);
            color: #72efdd;
            border-color: #72efdd;
        }

        .math-keyboard {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .math-keyboard.visible {
            display: grid;
        }

        .math-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .math-btn:hover {
            background: rgba(76, 201, 240, 0.3);
            transform: translateY(-2px);
        }

        .math-btn.operator {
            background: rgba(114, 239, 221, 0.2);
            color: #72efdd;
        }

        .math-btn.function {
            background: rgba(67, 97, 238, 0.2);
            color: #4361ee;
        }

        .math-btn.equals {
            background: linear-gradient(90deg, #72efdd, #4cc9f0);
            color: #1a1a2e;
            font-weight: bold;
        }

        .results-container {
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .results-header h2 {
            font-size: 1.8rem;
            color: #4cc9f0;
        }

        #clearResults {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        #clearResults:hover {
            background: rgba(244, 67, 54, 0.2);
            color: #ff8a80;
        }

        .results {
            display: grid;
            gap: 20px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .result-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .result-title {
            color: #4cc9f0;
            font-size: 1.4rem;
            margin-bottom: 10px;
            text-decoration: none;
            display: block;
        }

        .result-title:hover {
            text-decoration: underline;
        }

        .result-url {
            color: #72efdd;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: block;
        }

        .result-snippet {
            color: #e2e2e2;
            line-height: 1.6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #4cc9f0;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Блок: математический ответ */
        .math-answer {
            background: linear-gradient(135deg, rgba(114, 239, 221, 0.1), rgba(67, 97, 238, 0.1));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #72efdd;
            animation: fadeIn 0.5s ease-out;
        }

        .math-answer h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #72efdd;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .math-answer h3 i {
            font-size: 1.8rem;
        }

        .expression-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .expression {
            color: #fff;
            word-break: break-all;
        }

        .result {
            color: #72efdd;
            font-weight: bold;
            font-size: 1.5rem;
            text-align: right;
        }

        .calculation-steps {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            line-height: 1.7;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .step {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .step:last-child {
            border-bottom: none;
        }

        .step-number {
            color: #4cc9f0;
            font-weight: bold;
            margin-right: 10px;
        }

        .answer-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #b8c1ec;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .confidence {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            background: rgba(76, 201, 240, 0.2);
            border-radius: 20px;
        }

        .confidence-bar {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #72efdd, #4cc9f0);
            border-radius: 3px;
        }

        .source-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            background: rgba(114, 239, 221, 0.1);
            border-radius: 20px;
        }

        /* Прямой ответ */
        .direct-answer {
            background: linear-gradient(135deg, rgba(114, 239, 221, 0.1), rgba(76, 201, 240, 0.1));
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #72efdd;
            animation: fadeIn 0.5s ease-out;
        }

        .direct-answer h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #72efdd;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .direct-answer h3 i {
            font-size: 1.8rem;
        }

        .answer-content {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            line-height: 1.7;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* AI-суммаризация */
        .ai-summary {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(67, 97, 238, 0.1));
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #4cc9f0;
        }

        .ai-summary h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4cc9f0;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .ai-summary p {
            line-height: 1.6;
            color: #e2e2e2;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #b8c1ec;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2.5rem;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            #searchButton {
                padding: 18px;
                justify-content: center;
            }
            
            .container {
                padding: 10px;
            }
            
            .search-container {
                padding: 20px;
            }
            
            .direct-answer, .math-answer {
                padding: 20px;
            }
            
            .answer-meta {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .math-keyboard {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .mode-selector {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .math-keyboard {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>RavAI</h1>
            </div>
            <p class="tagline">Умный поиск с искусственным интеллектом и калькулятором</p>
        </header>

        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Введите ваш вопрос или математическое выражение...">
                <button id="searchButton">
                    <i class="fas fa-search"></i> Найти
                </button>
            </div>
            
            <div class="search-options">
                <div class="option-btn active" data-time="any">За все время</div>
                <div class="option-btn" data-time="day">За день</div>
                <div class="option-btn" data-time="week">За неделю</div>
                <div class="option-btn" data-time="month">За месяц</div>
            </div>
            
            <div class="mode-selector">
                <div class="mode-btn active" data-mode="search">
                    <i class="fas fa-search"></i> Обычный поиск
                </div>
                <div class="mode-btn" data-mode="math">
                    <i class="fas fa-calculator"></i> Режим математики
                </div>
            </div>
            
            <div class="math-keyboard" id="mathKeyboard">
                <div class="math-btn" data-value="7">7</div>
                <div class="math-btn" data-value="8">8</div>
                <div class="math-btn" data-value="9">9</div>
                <div class="math-btn operator" data-value="/">÷</div>
                <div class="math-btn operator" data-value="√">√</div>
                <div class="math-btn function" data-value="sin(">sin</div>
                
                <div class="math-btn" data-value="4">4</div>
                <div class="math-btn" data-value="5">5</div>
                <div class="math-btn" data-value="6">6</div>
                <div class="math-btn operator" data-value="*">×</div>
                <div class="math-btn operator" data-value="^">^</div>
                <div class="math-btn function" data-value="cos(">cos</div>
                
                <div class="math-btn" data-value="1">1</div>
                <div class="math-btn" data-value="2">2</div>
                <div class="math-btn" data-value="3">3</div>
                <div class="math-btn operator" data-value="-">−</div>
                <div class="math-btn operator" data-value="%">%</div>
                <div class="math-btn function" data-value="tan(">tan</div>
                
                <div class="math-btn" data-value="0">0</div>
                <div class="math-btn" data-value=".">.</div>
                <div class="math-btn" data-value="(">(</div>
                <div class="math-btn operator" data-value="+">+</div>
                <div class="math-btn" data-value=")">)</div>
                <div class="math-btn function" data-value="log(">log</div>
                
                <div class="math-btn" data-value="pi">π</div>
                <div class="math-btn" data-value="e">e</div>
                <div class="math-btn" id="clearMath">C</div>
                <div class="math-btn" id="backspaceMath">⌫</div>
                <div class="math-btn equals" id="calculateMath">=</div>
                <div class="math-btn function" data-value="ln(">ln</div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">RavAI ищет ответы...</p>
        </div>

        <div class="results-container" id="resultsContainer">
            <div class="results-header">
                <h2 id="resultsTitle">Результаты поиска</h2>
                <button id="clearResults">Очистить результаты</button>
            </div>
            
            <!-- Блок: математический ответ -->
            <div class="math-answer" id="mathAnswer">
                <h3><i class="fas fa-calculator"></i> Математическое решение</h3>
                <div class="expression-display">
                    <div class="expression" id="mathExpression">Введите выражение</div>
                    <div class="result" id="mathResult">= 0</div>
                </div>
                <div class="calculation-steps" id="calculationSteps">
                    <div class="step">
                        <span class="step-number">1.</span> Введите математическое выражение в поле поиска
                    </div>
                </div>
                <div class="answer-meta">
                    <div class="confidence">
                        <span>Точность расчета:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="mathConfidenceFill" style="width: 100%;"></div>
                        </div>
                        <span id="mathConfidencePercent">100%</span>
                    </div>
                    <div class="source-info">
                        <i class="fas fa-calculator"></i> 
                        <span id="mathSource">Встроенный математический движок RavAI</span>
                    </div>
                </div>
            </div>
            
            <!-- Блок: прямой ответ -->
            <div class="direct-answer" id="directAnswer">
                <h3><i class="fas fa-comment-dots"></i> Прямой ответ от RavAI</h3>
                <div class="answer-content" id="answerText">
                    Здесь появится прямой ответ на ваш вопрос без ссылок и дополнительной информации.
                </div>
                <div class="answer-meta">
                    <div class="confidence">
                        <span>Уверенность ответа:</span>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill" style="width: 85%;"></div>
                        </div>
                        <span id="confidencePercent">85%</span>
                    </div>
                    <div class="source-info">
                        <i class="fas fa-database"></i> 
                        <span id="sourceName">Источник: Wikipedia</span>
                    </div>
                </div>
            </div>
            
            <!-- AI-суммаризация -->
            <div class="ai-summary" id="aiSummary">
                <h3><i class="fas fa-robot"></i> Краткий ответ от RavAI</h3>
                <p id="summaryText">Здесь появится краткий ответ, сгенерированный искусственным интеллектом на основе найденных результатов.</p>
            </div>
            
            <!-- Результаты поиска -->
            <div class="results" id="results">
                <!-- Результаты будут добавлены сюда -->
            </div>
        </div>

        <footer>
            <p>RavAI &copy; 2023 | Поисковая система с искусственным интеллектом и математическим калькулятором</p>
            <p>Результаты предоставляются DuckDuckGo и Wikipedia API</p>
        </footer>
    </div>

    <script>
        // Элементы DOM
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const clearResultsBtn = document.getElementById('clearResults');
        const optionButtons = document.querySelectorAll('.option-btn');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const mathKeyboard = document.getElementById('mathKeyboard');
        const mathAnswer = document.getElementById('mathAnswer');
        const mathExpression = document.getElementById('mathExpression');
        const mathResult = document.getElementById('mathResult');
        const calculationSteps = document.getElementById('calculationSteps');
        const mathConfidenceFill = document.getElementById('mathConfidenceFill');
        const mathConfidencePercent = document.getElementById('mathConfidencePercent');
        const mathSource = document.getElementById('mathSource');
        const aiSummary = document.getElementById('aiSummary');
        const summaryText = document.getElementById('summaryText');
        const directAnswer = document.getElementById('directAnswer');
        const answerText = document.getElementById('answerText');
        const confidenceFill = document.getElementById('confidenceFill');
        const confidencePercent = document.getElementById('confidencePercent');
        const sourceName = document.getElementById('sourceName');
        const resultsTitle = document.getElementById('resultsTitle');

        // Переменные состояния
        let currentTimeFilter = 'any';
        let currentMode = 'search'; // 'search' или 'math'

        // Обработчики событий для кнопок времени
        optionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                optionButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentTimeFilter = btn.getAttribute('data-time');
            });
        });

        // Обработчики событий для кнопок режима
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                modeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.getAttribute('data-mode');
                
                // Показать/скрыть математическую клавиатуру
                if (currentMode === 'math') {
                    mathKeyboard.classList.add('visible');
                    searchInput.placeholder = "Введите математическое выражение...";
                    searchInput.focus();
                } else {
                    mathKeyboard.classList.remove('visible');
                    searchInput.placeholder = "Введите ваш вопрос или ключевые слова...";
                }
                
                // Скрыть все блоки результатов
                hideAllResultBlocks();
            });
        });

        // Обработчики для математической клавиатуры
        document.querySelectorAll('.math-btn[data-value]').forEach(btn => {
            btn.addEventListener('click', () => {
                const value = btn.getAttribute('data-value');
                insertMathSymbol(value);
            });
        });

        // Кнопка очистки математического выражения
        document.getElementById('clearMath').addEventListener('click', () => {
            searchInput.value = '';
            mathExpression.textContent = 'Введите выражение';
            mathResult.textContent = '= 0';
            calculationSteps.innerHTML = `
                <div class="step">
                    <span class="step-number">1.</span> Введите математическое выражение в поле поиска
                </div>
            `;
        });

        // Кнопка backspace
        document.getElementById('backspaceMath').addEventListener('click', () => {
            searchInput.value = searchInput.value.slice(0, -1);
        });

        // Кнопка расчета
        document.getElementById('calculateMath').addEventListener('click', () => {
            if (searchInput.value.trim()) {
                performSearch();
            }
        });

        // Вставка математического символа
        function insertMathSymbol(symbol) {
            const input = searchInput;
            const start = input.selectionStart;
            const end = input.selectionEnd;
            
            let symbolToInsert = symbol;
            
            // Замена символов для специальных значений
            if (symbol === 'pi') symbolToInsert = '3.1415926535';
            if (symbol === 'e') symbolToInsert = '2.7182818284';
            if (symbol === '√') symbolToInsert = 'sqrt(';
            
            input.value = input.value.substring(0, start) + symbolToInsert + input.value.substring(end);
            input.focus();
            input.setSelectionRange(start + symbolToInsert.length, start + symbolToInsert.length);
        }

        // Поиск при нажатии кнопки
        searchButton.addEventListener('click', performSearch);
        
        // Поиск при нажатии Enter
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Очистка результатов
        clearResultsBtn.addEventListener('click', () => {
            resultsContainer.style.display = 'none';
            resultsDiv.innerHTML = '';
            searchInput.value = '';
            hideAllResultBlocks();
        });

        // Скрыть все блоки результатов
        function hideAllResultBlocks() {
            aiSummary.style.display = 'none';
            directAnswer.style.display = 'none';
            mathAnswer.style.display = 'none';
        }

        // Функция выполнения поиска/расчета
        async function performSearch() {
            const query = searchInput.value.trim();
            
            if (!query) {
                searchInput.focus();
                return;
            }

            // Скрыть все блоки результатов
            hideAllResultBlocks();

            if (currentMode === 'math') {
                // Режим математики
                await calculateMathExpression(query);
            } else {
                // Обычный поиск
                await performRegularSearch(query);
            }
        }

        // Выполнить математический расчет
        async function calculateMathExpression(expression) {
            loadingText.textContent = 'RavAI вычисляет выражение...';
            loadingDiv.style.display = 'block';
            resultsContainer.style.display = 'none';

            try {
                // Имитация задержки вычисления
                await new Promise(resolve => setTimeout(resolve, 800));

                // Вычисление выражения
                const result = evaluateMathExpression(expression);
                
                // Обновление UI
                mathExpression.textContent = expression;
                mathResult.textContent = `= ${result.result}`;
                
                // Отображение шагов расчета
                displayCalculationSteps(expression, result.steps);
                
                // Установка высокой точности для математики
                mathConfidenceFill.style.width = '100%';
                mathConfidencePercent.textContent = '100%';
                mathSource.textContent = 'Встроенный математический движок RavAI';
                
                // Обновление заголовка
                resultsTitle.textContent = 'Математический расчет';
                
                // Показать результаты
                loadingDiv.style.display = 'none';
                resultsContainer.style.display = 'block';
                mathAnswer.style.display = 'block';
                
                // Прокрутить к результатам
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Ошибка вычисления:', error);
                loadingDiv.style.display = 'none';
                showMathError('Невозможно вычислить выражение. Проверьте синтаксис.');
            }
        }

        // Оценить математическое выражение
        function evaluateMathExpression(expression) {
            try {
                const steps = [];
                let processedExpr = expression;
                
                // Шаг 1: Замена констант
                steps.push('Замена математических констант');
                processedExpr = processedExpr
                    .replace(/pi/gi, '3.1415926535')
                    .replace(/\be\b/g, '2.7182818284');
                
                // Шаг 2: Замена операторов
                steps.push('Преобразование операторов');
                processedExpr = processedExpr
                    .replace(/\^/g, '**')
                    .replace(/÷/g, '/')
                    .replace(/×/g, '*')
                    .replace(/−/g, '-');
                
                // Шаг 3: Обработка функций
                steps.push('Вычисление математических функций');
                
                // Обработка sqrt
                processedExpr = processedExpr.replace(/sqrt\(([^)]+)\)/g, (match, content) => {
                    return `Math.sqrt(${content})`;
                });
                
                // Обработка sin, cos, tan
                processedExpr = processedExpr.replace(/(sin|cos|tan)\(([^)]+)\)/g, (match, func, content) => {
                    return `Math.${func}(${content} * Math.PI / 180)`;
                });
                
                // Обработка log (десятичный)
                processedExpr = processedExpr.replace(/log\(([^)]+)\)/g, (match, content) => {
                    return `Math.log10(${content})`;
                });
                
                // Обработка ln (натуральный)
                processedExpr = processedExpr.replace(/ln\(([^)]+)\)/g, (match, content) => {
                    return `Math.log(${content})`;
                });
                
                // Шаг 4: Обработка процентов
                if (processedExpr.includes('%')) {
                    steps.push('Вычисление процентов');
                    processedExpr = processedExpr.replace(/(\d+(\.\d+)?)%/g, (match, num) => {
                        return `(${num} / 100)`;
                    });
                }
                
                // Шаг 5: Безопасная оценка
                steps.push('Вычисление финального выражения');
                
                // Проверка безопасности выражения
                if (!/^[0-9+\-*/().\s,Math\[\]sqrtcossintanlog]+$/.test(processedExpr)) {
                    throw new Error('Недопустимые символы в выражении');
                }
                
                // Используем Function для безопасного вычисления
                const safeEval = new Function('return ' + processedExpr);
                const result = safeEval();
                
                // Форматирование результата
                let formattedResult;
                if (Math.abs(result) < 0.000001 && result !== 0) {
                    formattedResult = result.toExponential(6);
                } else if (Number.isInteger(result)) {
                    formattedResult = result.toString();
                } else {
                    formattedResult = parseFloat(result.toFixed(10)).toString();
                    // Удаляем лишние нули
                    formattedResult = formattedResult.replace(/(\.\d*?[1-9])0+$/, '$1').replace(/\.$/, '');
                }
                
                return {
                    result: formattedResult,
                    steps: steps
                };
                
            } catch (error) {
                throw new Error(`Ошибка вычисления: ${error.message}`);
            }
        }

        // Отображение шагов расчета
        function displayCalculationSteps(expression, steps) {
            calculationSteps.innerHTML = '';
            
            steps.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'step';
                stepDiv.innerHTML = `
                    <span class="step-number">${index + 1}.</span> ${step}
                `;
                calculationSteps.appendChild(stepDiv);
            });
            
            // Добавляем финальный шаг
            const finalStep = document.createElement('div');
            finalStep.className = 'step';
            finalStep.innerHTML = `
                <span class="step-number">${steps.length + 1}.</span> Результат: ${mathResult.textContent}
            `;
            calculationSteps.appendChild(finalStep);
        }

        // Показать ошибку математики
        function showMathError(message) {
            mathExpression.textContent = 'Ошибка';
            mathResult.textContent = '= NaN';
            calculationSteps.innerHTML = `
                <div class="step">
                    <span class="step-number">!</span> ${message}
                </div>
                <div class="step">
                    <span class="step-number">Совет:</span> Используйте цифры (0-9), операторы (+, -, *, /, ^), скобки и математические функции (sin, cos, tan, sqrt, log, ln)
                </div>
            `;
            mathConfidenceFill.style.width = '0%';
            mathConfidencePercent.textContent = '0%';
            
            mathAnswer.style.display = 'block';
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // Выполнить обычный поиск
        async function performRegularSearch(query) {
            loadingText.textContent = 'RavAI ищет ответы в интернете...';
            loadingDiv.style.display = 'block';
            resultsContainer.style.display = 'none';

            try {
                // Очистка предыдущих результатов
                resultsDiv.innerHTML = '';
                
                // Получение прямого ответа из Wikipedia
                await getWikipediaAnswer(query);
                
                // Генерация AI-ответа
                generateAISummary(query);
                
                // Имитация получения результатов из DuckDuckGo API
                const mockResults = generateMockResults(query);
                
                // Отображение результатов
                mockResults.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    resultItem.innerHTML = `
                        <a href="${result.url}" class="result-title" target="_blank">
                            <i class="fas fa-external-link-alt"></i> ${result.title}
                        </a>
                        <span class="result-url">${result.url}</span>
                        <p class="result-snippet">${result.snippet}</p>
                    `;
                    
                    resultsDiv.appendChild(resultItem);
                });
                
                // Обновление заголовка
                resultsTitle.textContent = 'Результаты поиска';
                
                // Показать результаты
                loadingDiv.style.display = 'none';
                resultsContainer.style.display = 'block';
                aiSummary.style.display = 'block';
                directAnswer.style.display = 'block';
                
                // Прокрутить к результатам
                resultsContainer.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Ошибка поиска:', error);
                loadingDiv.style.display = 'none';
                showError('Произошла ошибка при поиске. Пожалуйста, попробуйте снова.');
            }
        }

        // Получение ответа из Wikipedia API
        async function getWikipediaAnswer(query) {
            try {
                // Проверяем, не является ли запрос математическим выражением
                if (/[\d+\-*/().^%]/.test(query) && query.length < 50) {
                    // Это похоже на математическое выражение, но мы в режиме поиска
                    answerText.innerHTML = `
                        <h4>Математическое выражение: ${query}</h4>
                        <p>Вы ввели математическое выражение в режиме обычного поиска. Переключитесь в "Режим математики" для точного расчета.</p>
                    `;
                    confidenceFill.style.width = '60%';
                    confidencePercent.textContent = '60%';
                    sourceName.textContent = 'RavAI Анализ';
                    return;
                }
                
                const wikiResponse = await fetch(
                    `https://ru.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`
                );
                
                if (wikiResponse.ok) {
                    const data = await wikiResponse.json();
                    
                    answerText.innerHTML = `
                        <h4>${data.title || query}</h4>
                        <p>${data.extract || 'К сожалению, подробной информации по данному запросу не найдено.'}</p>
                        ${data.description ? `<p><strong>Описание:</strong> ${data.description}</p>` : ''}
                    `;
                    
                    const confidence = 92;
                    confidenceFill.style.width = `${confidence}%`;
                    confidencePercent.textContent = `${confidence}%`;
                    sourceName.textContent = 'Источник: Wikipedia';
                    
                    const wikiLink = `https://ru.wikipedia.org/wiki/${encodeURIComponent(query)}`;
                    
                    const wikiResult = document.createElement('div');
                    wikiResult.className = 'result-item';
                    wikiResult.style.order = '-1';
                    wikiResult.innerHTML = `
                        <a href="${wikiLink}" class="result-title" target="_blank">
                            <i class="fab fa-wikipedia-w"></i> ${data.title || query} - Wikipedia
                        </a>
                        <span class="result-url">${wikiLink}</span>
                        <p class="result-snippet">${data.extract || 'Статья на Wikipedia по данному запросу.'}</p>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #72efdd;">
                            <i class="fas fa-info-circle"></i> Основной источник информации для прямого ответа
                        </div>
                    `;
                    
                    resultsDiv.appendChild(wikiResult);
                    
                } else {
                    await getAlternativeAnswer(query);
                }
                
            } catch (error) {
                console.error('Ошибка при запросе к Wikipedia:', error);
                await getAlternativeAnswer(query);
            }
        }

        // Альтернативный источник данных
        async function getAlternativeAnswer(query) {
            try {
                const response = await fetch(
                    `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&pretty=1`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.Abstract) {
                        answerText.innerHTML = `
                            <h4>${data.Heading || query}</h4>
                            <p>${data.Abstract}</p>
                        `;
                        
                        const confidence = 78;
                        confidenceFill.style.width = `${confidence}%`;
                        confidencePercent.textContent = `${confidence}%`;
                        sourceName.textContent = 'Источник: DuckDuckGo Instant Answer';
                        
                    } else {
                        getLocalAnswer(query);
                    }
                } else {
                    getLocalAnswer(query);
                }
                
            } catch (error) {
                console.error('Ошибка при запросе к альтернативному источнику:', error);
                getLocalAnswer(query);
            }
        }

        // Локальная база знаний
        function getLocalAnswer(query) {
            const knowledgeBase = {
                'программирование': {
                    answer: 'Программирование — это процесс создания компьютерных программ с использованием языков программирования.',
                    confidence: 85
                },
                'искусственный интеллект': {
                    answer: 'Искусственный интеллект (ИИ) — это область компьютерных наук, занимающаяся созданием систем, способных выполнять задачи, требующие человеческого интеллекта.',
                    confidence: 82
                },
                'космос': {
                    answer: 'Космос (Вселенная) — это бесконечное пространство, содержащее галактики, звёзды, планеты и другие небесные тела.',
                    confidence: 80
                }
            };
            
            const queryLower = query.toLowerCase();
            let foundAnswer = null;
            let confidence = 70;
            
            for (const [key, data] of Object.entries(knowledgeBase)) {
                if (queryLower.includes(key)) {
                    foundAnswer = data.answer;
                    confidence = data.confidence;
                    break;
                }
            }
            
            if (!foundAnswer) {
                foundAnswer = `На основе анализа информации по запросу "${query}". Для получения более точной информации рекомендуется уточнить запрос или обратиться к специализированным источникам.`;
            }
            
            answerText.textContent = foundAnswer;
            confidenceFill.style.width = `${confidence}%`;
            confidencePercent.textContent = `${confidence}%`;
            sourceName.textContent = 'Источник: Локальная база знаний RavAI';
        }

        // Генерация AI-ответа (суммаризация)
        function generateAISummary(query) {
            const summaries = {
                'программирование': 'Программирование развивает логическое мышление и востребовано на рынке труда. Начните с Python или JavaScript, используйте онлайн-курсы и практические проекты.',
                'искусственный интеллект': 'ИИ трансформирует все отрасли. Для начала карьеры изучите Python, математику и фреймворки машинного обучения. Важны практические проекты.',
                'космос': 'Космические исследования расширяют границы науки. Современные миссии изучают Марс, экзопланеты и тёмную материю. Космос — следующий рубеж человечества.',
                'технологии': 'Технологический прогресс ускоряется. Ключевые тренды: AI, IoT, квантовые вычисления и устойчивые технологии. Непрерывное обучение обязательно.',
                'здоровье': 'Профилактика лучше лечения. Цифровое здравоохранение и персонализированная медицина — будущее. Регулярные обследования сохраняют здоровье.'
            };
            
            let summary = '';
            const queryLower = query.toLowerCase();
            
            for (const [key, value] of Object.entries(summaries)) {
                if (queryLower.includes(key)) {
                    summary = value;
                    break;
                }
            }
            
            if (!summary) {
                summary = `На основе анализа информации по запросу "${query}", RavAI рекомендует обратить внимание на практическое применение знаний. Информация взята из проверенных источников.`;
            }
            
            summaryText.textContent = summary;
        }

        // Генерация имитированных результатов
        function generateMockResults(query) {
            const baseResults = [
                {
                    title: `Что такое ${query}? - Полное руководство`,
                    url: `https://example.com/guide/${encodeURIComponent(query)}`,
                    snippet: `Подробная информация о "${query}" из проверенных источников. Основные концепции и практическое применение.`
                },
                {
                    title: `${query}: последние исследования`,
                    url: `https://research.example.com/${encodeURIComponent(query)}`,
                    snippet: `Современные исследования и научные открытия в области ${query}. Анализ текущих тенденций.`
                }
            ];
            
            return baseResults;
        }

        // Показать ошибку
        function showError(message) {
            resultsDiv.innerHTML = `
                <div class="result-item" style="text-align: center; background: rgba(244, 67, 54, 0.1);">
                    <h3 style="color: #ff8a80; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> Ошибка
                    </h3>
                    <p>${message}</p>
                    <button onclick="performSearch()" style="margin-top: 15px; padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Попробовать снова
                    </button>
                </div>
            `;
            resultsContainer.style.display = 'block';
        }

        // Примеры запросов при загрузке
        const exampleQueries = {
            search: [
                "Программирование",
                "Искусственный интеллект", 
                "HTML",
                "Космос",
                "Технологии"
            ],
            math: [
                "2+2*2",
                "sin(30)+cos(60)",
                "sqrt(16)+5^2",
                "π*5^2",
                "log(100)+ln(e^2)"
            ]
        };
        
        // Установить пример запроса
        function updatePlaceholder() {
            const examples = exampleQueries[currentMode];
            const example = examples[Math.floor(Math.random() * examples.length)];
            
            if (currentMode === 'math') {
                searchInput.placeholder = `Например: "${example}"`;
            } else {
                searchInput.placeholder = `Например: "${example}"`;
            }
        }
        
        // Обновлять placeholder при смене режима
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                setTimeout(updatePlaceholder, 100);
            });
        });
        
        updatePlaceholder();
        
        // Автоматическое определение режима при вводе
        searchInput.addEventListener('input', function() {
            const value = this.value.trim();
            
            // Если ввод начинается с числа или математического символа, предлагаем переключиться в режим математики
            if (/^[\d+\-*/().^%√]/.test(value) && currentMode === 'search') {
                // Можно добавить подсказку о переключении режима
            }
        });
    </script>
</body>
</html>
